version: "3"
services:
   krb5:
      image: flokkr/krb5
      hostname: krb5.kerberos-demo.local
      container_name: krb5
      ports:
        - 8081:8081
      volumes:
      - ./krb5.conf:/opt/launcher/plugins/011_kerberos/krb5.conf

   namenode1:
      image: flokkr/hadoop:${VERSION}
      hostname: namenode1.kerberos-demo.local
      container_name: namenode1
      ports:
         - 9870:9870
      env_file:
        - ./config
      environment:
          ENSURE_NAMENODE_DIR: "/tmp/hadoop-hadoop/dfs/name"
          SLEEP_SECONDS: 20
          # HADOOP_OPTS: "-Djava.net.preferIPv4Stack=true -Dsun.security.krb5.debug=true -Dsun.security.spnego.debug"
      command: ["hdfs", "namenode"]
      volumes:
         - ./krb5.conf:/opt/launcher/plugins/011_kerberos/krb5.conf
   namenode2:
      image: flokkr/hadoop:${VERSION}
      hostname: namenode2.kerberos-demo.local
      container_name: namenode2
      ports:
         - 9871:9870
      env_file:
        - ./config
      environment:
          ENSURE_STANDBY_NAMENODE_DIR: "/tmp/hadoop-hadoop/dfs/name"
          #ENSURE_NAMENODE_CLUSTERID: "sh"
          SLEEP_SECONDS: 40
          # HADOOP_OPTS: "-Djava.net.preferIPv4Stack=true -Dsun.security.krb5.debug=true -Dsun.security.spnego.debug"
      command: ["hdfs", "namenode"]
      volumes:
         - ./krb5.conf:/opt/launcher/plugins/011_kerberos/krb5.conf

   journal1:
      image: flokkr/hadoop:${VERSION}
      hostname: journal1.kerberos-demo.local
      container_name: journal1
      env_file:
        - ./config
      environment:
         # HADOOP_OPTS: "-Djava.net.preferIPv4Stack=true -Dsun.security.krb5.debug=true -Dsun.security.spnego.debug"
      command: ["hdfs", "journalnode"]
      volumes:
         - ./krb5.conf:/opt/launcher/plugins/011_kerberos/krb5.conf

   journal2:
      image: flokkr/hadoop:${VERSION}
      hostname: journal2.kerberos-demo.local
      container_name: journal2
      env_file:
        - ./config
      environment:
         # HADOOP_OPTS: "-Djava.net.preferIPv4Stack=true -Dsun.security.krb5.debug=true -Dsun.security.spnego.debug"
      command: ["hdfs", "journalnode"]
      volumes:
         - ./krb5.conf:/opt/launcher/plugins/011_kerberos/krb5.conf

   journal3:
      image: flokkr/hadoop:${VERSION}
      hostname: journal3.kerberos-demo.local
      container_name: journal3
      env_file:
        - ./config
      command: ["hdfs", "journalnode"]
      environment:
         # HADOOP_OPTS: "-Djava.net.preferIPv4Stack=true -Dsun.security.krb5.debug=true -Dsun.security.spnego.debug"
      volumes:
         - ./krb5.conf:/opt/launcher/plugins/011_kerberos/krb5.conf

   datanode:
      image: flokkr/hadoop:${VERSION}
      command: ["hdfs", "datanode"]
      hostname: datanode.kerberos-demo.local
      container_name: datanode
      env_file:
        - ./config
      environment:
         SLEEP_SECONDS: 50
         # HADOOP_OPTS: "-Djava.net.preferIPv4Stack=true -Dsun.security.krb5.debug=true -Dsun.security.spnego.debug"
      volumes:
         - ./krb5.conf:/opt/launcher/plugins/011_kerberos/krb5.conf

   resourcemanager:
      image: flokkr/hadoop:${VERSION}
      hostname: resourcemanager.kerberos-demo.local
      container_name: resourcemanager
      command: ["yarn", "resourcemanager"]
      ports:
         - 8088:8088
      env_file:
         - ./config
      volumes:
         - ./krb5.conf:/opt/launcher/plugins/011_kerberos/krb5.conf

   activator:
      image: flokkr/hadoop:${VERSION}
      hostname: activator.kerberos-demo.local
      container_name: activator
      command: ["hdfs", "haadmin", "-transitionToActive", "nn1"]
      env_file:
        - ./config
      environment:
         SLEEP_SECONDS: 60

networks:
   default:
      name: kerberos-demo.local