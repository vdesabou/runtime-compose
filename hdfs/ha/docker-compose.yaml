version: "3"
services:
   krb5:
      image: flokkr/krb5
      hostname: krb5
      container_name: krb5
      ports:
        - 8081:8081
      volumes:
      - ./krb5.conf:/etc/krb5.conf

   namenode1:
      image: flokkr/hadoop:${VERSION}
      hostname: namenode1
      container_name: namenode1
      privileged: true
      ports:
         - 9870:9870
      env_file:
        - ./config
      environment:
          ENSURE_NAMENODE_DIR: "/tmp/hadoop-hadoop/dfs/name"
          SLEEP_SECONDS: 20
      command: ["hdfs", "namenode"]
      volumes:
         - ./namenodeformat.sh:/opt/launcher/plugins/012_namenodeformat/namenodeformat.sh
         - ./krb5.conf:/opt/launcher/plugins/011_kerberos/krb5.conf
   namenode2:
      image: flokkr/hadoop:${VERSION}
      hostname: namenode2
      container_name: namenode2
      privileged: true
      ports:
         - 9871:9870
      env_file:
        - ./config
      environment:
          ENSURE_STANDBY_NAMENODE_DIR: "/tmp/hadoop-hadoop/dfs/name"
          SLEEP_SECONDS: 40
      command: ["hdfs", "namenode"]
      volumes:
         - ./namenodeformat.sh:/opt/launcher/plugins/012_namenodeformat/namenodeformat.sh
         - ./krb5.conf:/opt/launcher/plugins/011_kerberos/krb5.conf

   journal1:
      image: flokkr/hadoop:${VERSION}
      hostname: journal1
      container_name: journal1
      privileged: true
      env_file:
        - ./config
      command: ["hdfs", "journalnode"]
      volumes:
         - ./krb5.conf:/opt/launcher/plugins/011_kerberos/krb5.conf

   journal2:
      image: flokkr/hadoop:${VERSION}
      hostname: journal2
      container_name: journal2
      privileged: true
      env_file:
        - ./config
      command: ["hdfs", "journalnode"]
      volumes:
         - ./krb5.conf:/opt/launcher/plugins/011_kerberos/krb5.conf

   journal3:
      image: flokkr/hadoop:${VERSION}
      hostname: journal3
      container_name: journal3
      privileged: true
      env_file:
        - ./config
      command: ["hdfs", "journalnode"]
      volumes:
         - ./krb5.conf:/opt/launcher/plugins/011_kerberos/krb5.conf

   datanode:
      image: flokkr/hadoop:${VERSION}
      command: ["hdfs", "datanode"]
      container_name: datanode
      env_file:
        - ./config
      environment:
         SLEEP_SECONDS: 50
      volumes:
         - ./krb5.conf:/opt/launcher/plugins/011_kerberos/krb5.conf

   resourcemanager:
      image: flokkr/hadoop:${VERSION}
      hostname: resourcemanager
      command: ["yarn", "resourcemanager"]
      ports:
         - 8088:8088
      env_file:
         - ./config
      volumes:
         - ./krb5.conf:/opt/launcher/plugins/011_kerberos/krb5.conf

   activator:
      image: flokkr/hadoop:${VERSION}
      command: ["hdfs", "haadmin", "-transitionToActive", "nn1"]
      env_file:
        - ./config
      environment:
         SLEEP_SECONDS: 60
